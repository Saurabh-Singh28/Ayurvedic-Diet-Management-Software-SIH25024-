<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - Ayurvedic Diet Software</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 50%, #fef3c7 100%);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <a href="index.html" class="text-2xl font-bold text-green-600">üçÉ Ayurvedic Diet</a>
                    </div>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="index.html" class="text-gray-600 hover:text-green-600">Home</a>
                    <a href="patient.html" class="text-gray-600 hover:text-green-600">Patient</a>
                    <a href="foods.html" class="text-gray-600 hover:text-green-600">Foods</a>
                    <a href="diet.html" class="text-gray-600 hover:text-green-600">Diet Chart</a>
                    <a href="recipes.html" class="text-gray-600 hover:text-green-600">Recipes</a>
                    <a href="reports.html" class="text-green-600 font-medium">Reports</a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-8 text-center">üìä Reports & Analytics</h1>
            
            <!-- Summary Cards -->
            <div class="grid md:grid-cols-4 gap-6 mb-8">
                <div class="bg-green-50 rounded-lg p-6 text-center">
                    <div class="text-3xl font-bold text-green-600" id="totalPatients">0</div>
                    <div class="text-sm text-gray-600">Total Patients</div>
                </div>
                <div class="bg-blue-50 rounded-lg p-6 text-center">
                    <div class="text-3xl font-bold text-blue-600" id="totalRecipes">0</div>
                    <div class="text-sm text-gray-600">Saved Recipes</div>
                </div>
                <div class="bg-orange-50 rounded-lg p-6 text-center">
                    <div class="text-3xl font-bold text-orange-600" id="totalFoods">12</div>
                    <div class="text-sm text-gray-600">Food Items</div>
                </div>
                <div class="bg-purple-50 rounded-lg p-6 text-center">
                    <div class="text-3xl font-bold text-purple-600" id="totalDietCharts">0</div>
                    <div class="text-sm text-gray-600">Diet Charts</div>
                </div>
            </div>

            <!-- Patient Reports -->
            <div class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-900 mb-6">üë• Patient Reports</h2>
                <div id="patientReports" class="space-y-4">
                    <!-- Patient reports will be populated here -->
                </div>
            </div>

            <!-- Recipe Reports -->
            <div class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-900 mb-6">üë®‚Äçüç≥ Recipe Reports</h2>
                <div id="recipeReports" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Recipe reports will be populated here -->
                </div>
            </div>

            <!-- System Analytics -->
            <div class="mb-8">
                <h2 class="text-2xl font-semibold text-gray-900 mb-6">üìà System Analytics</h2>
                <div class="grid md:grid-cols-2 gap-6">
                    <!-- Ayurvedic Properties Distribution -->
                    <div class="bg-white border-2 border-gray-200 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">üåø Ayurvedic Properties Distribution</h3>
                        <div id="propertiesChart" class="space-y-2">
                            <!-- Chart will be populated here -->
                        </div>
                    </div>

                    <!-- Rasa Distribution -->
                    <div class="bg-white border-2 border-gray-200 rounded-lg p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">üçØ Rasa Distribution</h3>
                        <div id="rasaChart" class="space-y-2">
                            <!-- Chart will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Export Options -->
            <div class="bg-gray-50 rounded-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4">üì§ Export Reports</h2>
                <div class="flex flex-col sm:flex-row gap-4">
                    <button id="exportAllPatients" class="bg-green-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-700 transition duration-300">
                        <i class="fas fa-users mr-2"></i>Export All Patients
                    </button>
                    <button id="exportAllRecipes" class="bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-300">
                        <i class="fas fa-book mr-2"></i>Export All Recipes
                    </button>
                    <button id="exportSystemReport" class="bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition duration-300">
                        <i class="fas fa-chart-bar mr-2"></i>Export System Report
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadReports();
            setupEventListeners();
        });

        function setupEventListeners() {
            document.getElementById('exportAllPatients').addEventListener('click', exportAllPatients);
            document.getElementById('exportAllRecipes').addEventListener('click', exportAllRecipes);
            document.getElementById('exportSystemReport').addEventListener('click', exportSystemReport);
        }

        function loadReports() {
            loadSummaryCards();
            loadPatientReports();
            loadRecipeReports();
            loadAnalytics();
        }

        function loadSummaryCards() {
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
            const selectedFoods = JSON.parse(localStorage.getItem('selectedFoods') || '[]');

            document.getElementById('totalPatients').textContent = patients.length;
            document.getElementById('totalRecipes').textContent = recipes.length;
            document.getElementById('totalDietCharts').textContent = selectedFoods.length > 0 ? 1 : 0;
        }

        function loadPatientReports() {
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const container = document.getElementById('patientReports');

            if (patients.length === 0) {
                container.innerHTML = '<p class="text-gray-500 italic">No patients found. <a href="patient.html" class="text-green-600 hover:underline">Add a patient</a></p>';
                return;
            }

            container.innerHTML = patients.map(patient => `
                <div class="bg-white border-2 border-gray-200 rounded-lg p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-900">${patient.name}</h3>
                            <p class="text-sm text-gray-600">${patient.age} years, ${patient.gender}</p>
                        </div>
                        <div class="text-right text-sm text-gray-500">
                            <div>Created: ${new Date(patient.createdAt).toLocaleDateString()}</div>
                            <div>Diet Type: ${patient.dietType || 'Not specified'}</div>
                        </div>
                    </div>
                    
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <h4 class="font-medium text-gray-700 mb-2">Health Information</h4>
                            <div class="text-sm text-gray-600 space-y-1">
                                <div>Meal Frequency: ${patient.mealFrequency || 'Not specified'} meals/day</div>
                                <div>Water Intake: ${patient.waterIntake || 'Not specified'}</div>
                                <div>Bowel Movements: ${patient.bowelMovements || 'Not specified'}</div>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-medium text-gray-700 mb-2">Ayurvedic Assessment</h4>
                            <div class="text-sm text-gray-600 space-y-1">
                                <div>Prakriti: ${patient.prakriti || 'Not assessed'}</div>
                                <div>Vikriti: ${patient.vikriti || 'Not assessed'}</div>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-2">
                        <button onclick="generatePatientReport('${patient.id}')" class="bg-green-500 text-white px-4 py-2 rounded text-sm hover:bg-green-600">
                            <i class="fas fa-file-pdf mr-1"></i>Generate Report
                        </button>
                        <button onclick="viewPatientDetails('${patient.id}')" class="bg-blue-500 text-white px-4 py-2 rounded text-sm hover:bg-blue-600">
                            <i class="fas fa-eye mr-1"></i>View Details
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadRecipeReports() {
            const recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
            const container = document.getElementById('recipeReports');

            if (recipes.length === 0) {
                container.innerHTML = '<p class="text-gray-500 italic col-span-full text-center">No recipes found. <a href="recipes.html" class="text-green-600 hover:underline">Create a recipe</a></p>';
                return;
            }

            container.innerHTML = recipes.map(recipe => `
                <div class="bg-white border-2 border-gray-200 rounded-lg p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">${recipe.name}</h3>
                    <p class="text-sm text-gray-600 mb-3">${recipe.description || 'No description'}</p>
                    
                    <div class="grid grid-cols-2 gap-2 text-sm text-gray-500 mb-4">
                        <div>üë• ${recipe.servings} servings</div>
                        <div>‚è±Ô∏è ${recipe.cookingTime} min</div>
                        <div>ü•ò ${recipe.ingredients.length} ingredients</div>
                        <div>üìÖ ${new Date(recipe.createdAt).toLocaleDateString()}</div>
                    </div>

                    <div class="flex gap-2">
                        <button onclick="generateRecipeReport('${recipe.id}')" class="bg-green-500 text-white px-3 py-1 rounded text-sm hover:bg-green-600">
                            <i class="fas fa-file-pdf mr-1"></i>Export
                        </button>
                        <button onclick="viewRecipeDetails('${recipe.id}')" class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                            <i class="fas fa-eye mr-1"></i>View
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function loadAnalytics() {
            const recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
            
            // Analyze Ayurvedic properties
            const properties = { hot: 0, cold: 0, light: 0, heavy: 0 };
            const rasaCount = { sweet: 0, sour: 0, salty: 0, bitter: 0, pungent: 0, astringent: 0 };

            recipes.forEach(recipe => {
                recipe.ingredients.forEach(ingredient => {
                    ingredient.properties.forEach(prop => {
                        if (properties.hasOwnProperty(prop)) {
                            properties[prop]++;
                        }
                    });
                    if (rasaCount.hasOwnProperty(ingredient.rasa)) {
                        rasaCount[ingredient.rasa]++;
                    }
                });
            });

            // Display properties chart
            const propertiesContainer = document.getElementById('propertiesChart');
            propertiesContainer.innerHTML = Object.entries(properties).map(([prop, count]) => `
                <div class="flex justify-between items-center">
                    <span>${getPropertyIcon(prop)} ${prop.charAt(0).toUpperCase() + prop.slice(1)}</span>
                    <div class="flex items-center gap-2">
                        <div class="w-20 bg-gray-200 rounded-full h-2">
                            <div class="bg-green-500 h-2 rounded-full" style="width: ${Math.min(100, (count / Math.max(...Object.values(properties))) * 100)}%"></div>
                        </div>
                        <span class="text-sm font-medium">${count}</span>
                    </div>
                </div>
            `).join('');

            // Display rasa chart
            const rasaContainer = document.getElementById('rasaChart');
            rasaContainer.innerHTML = Object.entries(rasaCount).map(([rasa, count]) => `
                <div class="flex justify-between items-center">
                    <span>${getRasaIcon(rasa)} ${rasa.charAt(0).toUpperCase() + rasa.slice(1)}</span>
                    <div class="flex items-center gap-2">
                        <div class="w-20 bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-500 h-2 rounded-full" style="width: ${Math.min(100, (count / Math.max(...Object.values(rasaCount))) * 100)}%"></div>
                        </div>
                        <span class="text-sm font-medium">${count}</span>
                    </div>
                </div>
            `).join('');
        }

        function getPropertyIcon(property) {
            const icons = {
                hot: 'üî•',
                cold: '‚ùÑÔ∏è',
                light: 'üçÉ',
                heavy: 'üç≤'
            };
            return icons[property] || 'üçÉ';
        }

        function getRasaIcon(rasa) {
            const icons = {
                sweet: 'üçØ',
                sour: 'üçã',
                salty: 'üßÇ',
                bitter: 'üåø',
                pungent: 'üå∂Ô∏è',
                astringent: 'üçÉ'
            };
            return icons[rasa] || 'üçÉ';
        }

        function generatePatientReport(patientId) {
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const patient = patients.find(p => p.id === patientId);
            if (!patient) return;

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.text('Patient Report', 20, 20);
            
            // Add patient info
            doc.setFontSize(12);
            doc.text(`Patient: ${patient.name}`, 20, 35);
            doc.text(`Age: ${patient.age} years`, 20, 45);
            doc.text(`Gender: ${patient.gender}`, 20, 55);
            doc.text(`Diet Type: ${patient.dietType || 'Not specified'}`, 20, 65);
            doc.text(`Created: ${new Date(patient.createdAt).toLocaleDateString()}`, 20, 75);
            
            // Add health information
            doc.setFontSize(14);
            doc.text('Health Information', 20, 95);
            doc.setFontSize(10);
            doc.text(`Meal Frequency: ${patient.mealFrequency || 'Not specified'}`, 20, 105);
            doc.text(`Water Intake: ${patient.waterIntake || 'Not specified'}`, 20, 115);
            doc.text(`Bowel Movements: ${patient.bowelMovements || 'Not specified'}`, 20, 125);
            
            // Add Ayurvedic assessment
            doc.setFontSize(14);
            doc.text('Ayurvedic Assessment', 20, 145);
            doc.setFontSize(10);
            doc.text(`Prakriti: ${patient.prakriti || 'Not assessed'}`, 20, 155);
            doc.text(`Vikriti: ${patient.vikriti || 'Not assessed'}`, 20, 165);
            
            if (patient.healthConditions) {
                doc.text(`Health Conditions: ${patient.healthConditions}`, 20, 175);
            }
            
            doc.save(`patient-report-${patient.name.replace(/\s+/g, '-').toLowerCase()}.pdf`);
        }

        function generateRecipeReport(recipeId) {
            const recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.text('Recipe Report', 20, 20);
            
            // Add recipe info
            doc.setFontSize(12);
            doc.text(`Recipe: ${recipe.name}`, 20, 35);
            doc.text(`Servings: ${recipe.servings}`, 20, 45);
            doc.text(`Cooking Time: ${recipe.cookingTime} minutes`, 20, 55);
            doc.text(`Created: ${new Date(recipe.createdAt).toLocaleDateString()}`, 20, 65);
            
            // Add description
            if (recipe.description) {
                doc.setFontSize(14);
                doc.text('Description', 20, 85);
                doc.setFontSize(10);
                doc.text(recipe.description, 20, 95);
            }
            
            // Add ingredients
            doc.setFontSize(14);
            doc.text('Ingredients', 20, 115);
            doc.setFontSize(10);
            let yPosition = 125;
            recipe.ingredients.forEach(ingredient => {
                doc.text(`‚Ä¢ ${ingredient.name}: ${ingredient.quantity} ${ingredient.unit}`, 20, yPosition);
                yPosition += 10;
            });
            
            // Add instructions
            if (recipe.instructions) {
                doc.setFontSize(14);
                doc.text('Instructions', 20, yPosition + 10);
                doc.setFontSize(10);
                doc.text(recipe.instructions, 20, yPosition + 20);
            }
            
            doc.save(`recipe-report-${recipe.name.replace(/\s+/g, '-').toLowerCase()}.pdf`);
        }

        function exportAllPatients() {
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            if (patients.length === 0) {
                alert('No patients to export.');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('All Patients Report', 20, 20);
            
            let yPosition = 40;
            patients.forEach((patient, index) => {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFontSize(12);
                doc.text(`${index + 1}. ${patient.name} (${patient.age} years, ${patient.gender})`, 20, yPosition);
                yPosition += 10;
                doc.setFontSize(10);
                doc.text(`   Diet Type: ${patient.dietType || 'Not specified'}`, 20, yPosition);
                yPosition += 10;
                doc.text(`   Created: ${new Date(patient.createdAt).toLocaleDateString()}`, 20, yPosition);
                yPosition += 15;
            });
            
            doc.save('all-patients-report.pdf');
        }

        function exportAllRecipes() {
            const recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
            if (recipes.length === 0) {
                alert('No recipes to export.');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(20);
            doc.text('All Recipes Report', 20, 20);
            
            let yPosition = 40;
            recipes.forEach((recipe, index) => {
                if (yPosition > 250) {
                    doc.addPage();
                    yPosition = 20;
                }
                
                doc.setFontSize(12);
                doc.text(`${index + 1}. ${recipe.name}`, 20, yPosition);
                yPosition += 10;
                doc.setFontSize(10);
                doc.text(`   Servings: ${recipe.servings} | Cooking Time: ${recipe.cookingTime} min`, 20, yPosition);
                yPosition += 10;
                doc.text(`   Ingredients: ${recipe.ingredients.length} | Created: ${new Date(recipe.createdAt).toLocaleDateString()}`, 20, yPosition);
                yPosition += 15;
            });
            
            doc.save('all-recipes-report.pdf');
        }

        function exportSystemReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
            const selectedFoods = JSON.parse(localStorage.getItem('selectedFoods') || '[]');
            
            doc.setFontSize(20);
            doc.text('System Report', 20, 20);
            
            doc.setFontSize(14);
            doc.text('Summary Statistics', 20, 40);
            doc.setFontSize(10);
            doc.text(`Total Patients: ${patients.length}`, 20, 55);
            doc.text(`Total Recipes: ${recipes.length}`, 20, 65);
            doc.text(`Active Diet Charts: ${selectedFoods.length > 0 ? 1 : 0}`, 20, 75);
            doc.text(`Report Generated: ${new Date().toLocaleString()}`, 20, 85);
            
            doc.save('system-report.pdf');
        }

        function viewPatientDetails(patientId) {
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const patient = patients.find(p => p.id === patientId);
            if (!patient) return;

            alert(`Patient Details:\nName: ${patient.name}\nAge: ${patient.age}\nGender: ${patient.gender}\nDiet Type: ${patient.dietType || 'Not specified'}\nHealth Conditions: ${patient.healthConditions || 'None'}`);
        }

        function viewRecipeDetails(recipeId) {
            const recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
            const recipe = recipes.find(r => r.id === recipeId);
            if (!recipe) return;

            alert(`Recipe Details:\nName: ${recipe.name}\nServings: ${recipe.servings}\nCooking Time: ${recipe.cookingTime} minutes\nIngredients: ${recipe.ingredients.length} items\nDescription: ${recipe.description || 'No description'}`);
        }

        // Make functions globally available
        window.generatePatientReport = generatePatientReport;
        window.generateRecipeReport = generateRecipeReport;
        window.viewPatientDetails = viewPatientDetails;
        window.viewRecipeDetails = viewRecipeDetails;
    </script>
</body>
</html>
